<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Budget App</title>
    <style>
      :root {
        /* iOS Colors */
        --ios-blue: #007aff;
        --ios-blue-light: #5ac8fa;
        --ios-blue-dark: #0051d0;
        --ios-red: #ff3b30;
        --ios-red-light: #ff6961;
        --ios-red-dark: #d70015;
        --ios-green: #34c759;
        --ios-orange: #ff9500;
        --ios-purple: #af52de;
        --ios-gray: #8e8e93;
        --ios-gray-light: #c7c7cc;
        --ios-gray-ultralight: #f2f2f7;
        --ios-separator: rgba(60, 60, 67, 0.36);

        /* iOS Backgrounds */
        --ios-background: #f2f2f7;
        --ios-grouped-background: #ffffff;
        --ios-secondary-background: #ffffff;
        --ios-tertiary-background: #f2f2f7;

        /* iOS Text Colors */
        --ios-label: #000000;
        --ios-secondary-label: rgba(60, 60, 67, 0.6);
        --ios-tertiary-label: rgba(60, 60, 67, 0.3);
        --ios-quaternary-label: rgba(60, 60, 67, 0.18);

        /* Spacing */
        --spacing-xs: 0.25rem;
        --spacing-sm: 0.5rem;
        --spacing-md: 0.75rem;
        --spacing-lg: 1rem;
        --spacing-xl: 1.25rem;
        --spacing-2xl: 2rem;
        --spacing-3xl: 3rem;

        /* iOS Border radius */
        --ios-radius: 0.625rem;
        --ios-radius-large: 1rem;
        --ios-radius-xl: 1.25rem;

        /* iOS Typography */
        --ios-title1: 1.75rem;
        --ios-title2: 1.375rem;
        --ios-title3: 1.25rem;
        --ios-headline: 1.063rem;
        --ios-body: 1rem;
        --ios-callout: 1rem;
        --ios-subhead: 0.938rem;
        --ios-footnote: 0.813rem;
        --ios-caption1: 0.75rem;
        --ios-caption2: 0.688rem;

        /* iOS Shadows */
        --ios-shadow-light: 0 1px 3px rgba(0, 0, 0, 0.12);
        --ios-shadow-medium: 0 4px 6px rgba(0, 0, 0, 0.07);
        --ios-shadow-large: 0 10px 25px rgba(0, 0, 0, 0.15);
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display",
          "SF Pro Text", sans-serif;
        background: var(--ios-background);
        color: var(--ios-label);
        line-height: 1.4;
        padding: 0;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      /* iOS-style app container */
      .app-container {
        max-width: 26rem;
        margin: 0 auto;
        background: var(--ios-background);
        min-height: 100vh;
        padding: var(--spacing-lg);
      }

      /* iOS-style sections */
      fieldset {
        border: none;
        border-radius: var(--ios-radius);
        margin-bottom: var(--spacing-2xl);
        padding: 0;
        background: var(--ios-grouped-background);
        box-shadow: var(--ios-shadow-light);
        overflow: hidden;
      }

      /* iOS-style section headers */
      legend {
        width: 100%;
        padding: var(--spacing-lg) var(--spacing-xl);
        background: var(--ios-grouped-background);
        color: var(--ios-label);
        font-size: var(--ios-title3);
        font-weight: 600;
        border: none;
        border-radius: 0;
        text-shadow: none;
        box-shadow: none;
        border-bottom: 1px solid var(--ios-separator);
        margin-bottom: 0;
      }

      /* iOS-style list items */
      .expense-item {
        border-bottom: 1px solid var(--ios-separator);
        padding: var(--spacing-lg) var(--spacing-xl);
        background: var(--ios-grouped-background);
        position: relative;
      }

      .expense-item:last-child {
        border-bottom: none;
      }

      /* iOS-style input rows */
      .name-row {
        margin-bottom: var(--spacing-lg);
        display: flex;
        align-items: center;
        gap: var(--spacing-lg);
      }

      .name-row input {
        flex: 1;
      }

      .name-row .remove-expense {
        flex: 0 0 auto;
      }

      .details-row {
        display: flex;
        gap: var(--spacing-lg);
        align-items: center;
      }

      .details-row input,
      .details-row select {
        flex: 1;
        min-width: 0;
      }

      .details-row .amount-input-wrapper {
        flex: 1;
        min-width: 0;
      }

      .details-row .day-input-wrapper {
        flex: 1;
        min-width: 0;
      }

      /* iOS-style text-only remove button */
      .expense-item .remove-expense {
        width: auto;
        height: auto;
        border-radius: 0;
        background: transparent;
        color: var(--ios-red);
        border: none;
        font-size: var(--ios-body);
        font-weight: 400;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: var(--spacing-sm) var(--spacing-md);
        margin: 0;
        line-height: 1;
        transition: all 0.2s ease;
        opacity: 0.8;
        flex-shrink: 0;
      }

      .expense-item .remove-expense:hover {
        background: transparent;
        color: var(--ios-red-dark);
        opacity: 1;
      }

      .expense-item .remove-expense:active {
        transform: scale(0.95);
        opacity: 0.6;
      }

      /* iOS-style labels */
      label {
        display: block;
        margin-bottom: var(--spacing-sm);
        font-weight: 400;
        color: var(--ios-secondary-label);
        font-size: var(--ios-footnote);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      /* iOS-style inputs */
      input,
      select {
        width: 100%;
        padding: var(--spacing-lg);
        border: none;
        border-radius: var(--ios-radius);
        font-size: var(--ios-body);
        background: var(--ios-tertiary-background);
        color: var(--ios-label);
        -webkit-appearance: none;
        appearance: none;
        font-family: inherit;
        transition: all 0.2s ease;
      }

      /* iOS-style select dropdown */
      select {
        background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23007aff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right var(--spacing-lg) center;
        background-size: 1rem;
        padding-right: 3rem;
      }

      input[name="pay-day"] {
        width: 5rem;
        text-align: center;
      }

      /* iOS-style input prefixes */
      .amount-input-wrapper {
        position: relative;
      }

      .amount-input-wrapper::before {
        content: "Â£";
        position: absolute;
        left: var(--spacing-lg);
        top: 50%;
        transform: translateY(-50%);
        color: var(--ios-secondary-label);
        font-size: var(--ios-body);
        font-weight: 500;
        pointer-events: none;
        z-index: 1;
      }

      .day-input-wrapper {
        position: relative;
      }

      .day-input-wrapper::before {
        content: "Day:";
        position: absolute;
        left: var(--spacing-lg);
        top: 50%;
        transform: translateY(-50%);
        color: var(--ios-secondary-label);
        font-size: var(--ios-body);
        font-weight: 500;
        pointer-events: none;
        z-index: 1;
      }

      input[name$="-amount"] {
        padding-left: 2.5rem;
      }

      input[name="monthly-day"] {
        padding-left: 3.5rem;
      }

      /* iOS-style focus states */
      input:focus,
      select:focus {
        outline: none;
        background: white;
        box-shadow: 0 0 0 2px var(--ios-blue);
        transform: scale(1.02);
      }

      /* iOS-style buttons */
      button:not(.remove-expense) {
        width: 100%;
        padding: var(--spacing-xl);
        background: transparent;
        color: var(--ios-blue);
        border: none;
        border-radius: var(--ios-radius);
        font-size: var(--ios-body);
        font-weight: 400;
        cursor: pointer;
        margin: 0;
        transition: all 0.2s ease;
        font-family: inherit;
      }

      button:not(.remove-expense):hover {
        background: rgba(0, 122, 255, 0.1);
        color: var(--ios-blue-dark);
      }

      button:not(.remove-expense):active {
        transform: scale(0.98);
        background: rgba(0, 122, 255, 0.2);
      }

      /* Container spacing */
      #monthly-expenses-container,
      #weekly-expenses-container,
      #daily-expenses-container {
        margin-bottom: 0;
      }

      /* iOS-style totals section */
      .totals-fieldset {
        background: linear-gradient(
          135deg,
          var(--ios-blue) 0%,
          var(--ios-purple) 100%
        );
        color: white;
        border: none;
        box-shadow: 0 8px 32px rgba(0, 122, 255, 0.3);
      }

      .totals-fieldset legend {
        background: transparent;
        color: white;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        font-size: var(--ios-title2);
        font-weight: 700;
        position: static;
        margin: 0;
        padding: var(--spacing-xl) var(--spacing-xl) var(--spacing-lg)
          var(--spacing-xl);
      }

      .totals-fieldset label {
        color: white;
        font-size: var(--ios-body);
        margin-bottom: var(--spacing-lg);
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 var(--spacing-xl);
        text-transform: none;
        letter-spacing: normal;
      }

      .totals-fieldset span {
        font-weight: 700;
        font-size: var(--ios-title3);
      }

      .totals-fieldset input {
        background: rgba(255, 255, 255, 0.15);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        backdrop-filter: blur(10px);
      }

      .totals-fieldset input:focus {
        background: rgba(255, 255, 255, 0.25);
        border-color: rgba(255, 255, 255, 0.6);
        box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.3);
      }

      .totals-fieldset input::placeholder {
        color: rgba(255, 255, 255, 0.7);
      }

      hr {
        border: none;
        height: 1px;
        background: rgba(255, 255, 255, 0.2);
        margin: var(--spacing-lg) var(--spacing-xl);
      }

      /* iOS-style responsive improvements */
      @media (max-width: 30rem) {
        .app-container {
          padding: var(--spacing-md);
        }

        fieldset {
          border-radius: var(--ios-radius);
          margin-bottom: var(--spacing-xl);
        }

        legend {
          font-size: var(--ios-title3);
          padding: var(--spacing-lg);
        }

        .expense-item {
          padding: var(--spacing-lg);
        }

        input,
        select,
        button {
          font-size: var(--ios-body);
        }
      }

      /* iOS-style loading animation */
      .expense-item {
        animation: slideInFromRight 0.3s ease-out;
      }

      @keyframes slideInFromRight {
        from {
          opacity: 0;
          transform: translateX(20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      /* iOS-style touch improvements */
      button,
      input,
      select {
        min-height: 2.75rem;
        -webkit-tap-highlight-color: transparent;
      }

      /* iOS-style footer */
      footer {
        margin-top: var(--spacing-3xl);
        padding: var(--spacing-2xl) var(--spacing-xl);
        background: var(--ios-grouped-background);
        border-radius: var(--ios-radius);
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: var(--ios-footnote);
        color: var(--ios-secondary-label);
        box-shadow: var(--ios-shadow-light);
      }

      footer .copyright {
        font-weight: 600;
        color: var(--ios-label);
      }

      footer .tagline {
        font-style: italic;
        color: var(--ios-tertiary-label);
      }

      @media (max-width: 30rem) {
        footer {
          flex-direction: column;
          gap: var(--spacing-sm);
          text-align: center;
          margin-top: var(--spacing-2xl);
          padding: var(--spacing-xl);
        }
      }
    </style>
  </head>
  <body>
    <div class="app-container">
      <form id="budget-form">
        <fieldset class="totals-fieldset">
          <legend>Totals</legend>
          <div>
            <label>Monthly Total: <span id="monthly-total">Â£0.00</span></label>
          </div>
          <hr />
          <div>
            <label
              >Pay day:
              <input
                type="number"
                name="pay-day"
                step="1"
                min="1"
                max="31"
                value="25"
              />
            </label>
          </div>
          <div>
            <label
              >Expenses Until Payday:
              <span id="payday-total">Â£0.00</span></label
            >
          </div>
        </fieldset>

        <template id="monthly-expense-template">
          <div class="expense-item monthly-expense">
            <div class="name-row">
              <input type="text" name="monthly-name" placeholder="Name" />
              <button
                type="button"
                class="remove-expense"
                aria-label="Remove expense"
              >
                Delete
              </button>
            </div>
            <div class="details-row">
              <div class="amount-input-wrapper">
                <input
                  type="number"
                  name="monthly-amount"
                  step="0.01"
                  inputmode="decimal"
                  placeholder="Amount"
                />
              </div>
              <div class="day-input-wrapper">
                <input
                  type="number"
                  name="monthly-day"
                  min="1"
                  max="31"
                  inputmode="numeric"
                  placeholder="Day of the month"
                />
              </div>
            </div>
          </div>
        </template>

        <template id="weekly-expense-template">
          <div class="expense-item weekly-expense">
            <div class="name-row">
              <input type="text" name="weekly-name" placeholder="Name" />
              <button
                type="button"
                class="remove-expense"
                aria-label="Remove expense"
              >
                Delete
              </button>
            </div>
            <div class="details-row">
              <div class="amount-input-wrapper">
                <input
                  type="number"
                  name="weekly-amount"
                  step="0.01"
                  inputmode="decimal"
                  placeholder="Amount"
                />
              </div>
              <select name="weekly-day">
                <option value="">Day of Week</option>
                <option value="monday">Monday</option>
                <option value="tuesday">Tuesday</option>
                <option value="wednesday">Wednesday</option>
                <option value="thursday">Thursday</option>
                <option value="friday">Friday</option>
                <option value="saturday">Saturday</option>
                <option value="sunday">Sunday</option>
              </select>
            </div>
          </div>
        </template>

        <template id="daily-expense-template">
          <div class="expense-item daily-expense">
            <div class="name-row">
              <input type="text" name="daily-name" placeholder="Name" />
              <button
                type="button"
                class="remove-expense"
                aria-label="Remove expense"
              >
                Delete
              </button>
            </div>
            <div class="details-row">
              <div class="amount-input-wrapper">
                <input
                  type="number"
                  name="daily-amount"
                  step="0.01"
                  inputmode="decimal"
                  placeholder="Amount"
                />
              </div>
            </div>
          </div>
        </template>

        <fieldset>
          <legend>Monthly Expenses</legend>
          <div id="monthly-expenses-container"></div>
          <button type="button" id="add-monthly-expense">
            Add Monthly Expense
          </button>
        </fieldset>

        <fieldset>
          <legend>Weekly Expenses</legend>
          <div id="weekly-expenses-container"></div>
          <button type="button" id="add-weekly-expense">
            Add Weekly Expense
          </button>
        </fieldset>

        <fieldset>
          <legend>Daily Expenses</legend>
          <div id="daily-expenses-container"></div>
          <button type="button" id="add-daily-expense">
            Add Daily Expense
          </button>
        </fieldset>

        <script>
          // Constants
          const EXPENSE_TYPES = {
            MONTHLY: "monthly",
            WEEKLY: "weekly",
            DAILY: "daily",
          };

          const DAYS_IN_MONTH = 31;
          const DAYS_IN_WEEK = 7;
          const MS_PER_DAY = 1000 * 60 * 60 * 24;

          const DAY_MAP = {
            sunday: 0,
            monday: 1,
            tuesday: 2,
            wednesday: 3,
            thursday: 4,
            friday: 5,
            saturday: 6,
          };

          // Cache DOM elements
          const elements = {
            form: document.getElementById("budget-form"),
            monthlyTemplate: document.getElementById(
              "monthly-expense-template"
            ),
            monthlyContainer: document.getElementById(
              "monthly-expenses-container"
            ),
            addMonthlyButton: document.getElementById("add-monthly-expense"),
            weeklyTemplate: document.getElementById("weekly-expense-template"),
            weeklyContainer: document.getElementById(
              "weekly-expenses-container"
            ),
            addWeeklyButton: document.getElementById("add-weekly-expense"),
            dailyTemplate: document.getElementById("daily-expense-template"),
            dailyContainer: document.getElementById("daily-expenses-container"),
            addDailyButton: document.getElementById("add-daily-expense"),
            monthlyTotal: document.getElementById("monthly-total"),
            paydayTotal: document.getElementById("payday-total"),
            payDayInput: document.querySelector('input[name="pay-day"]'),
          };

          // Currency formatter
          const formatCurrency = (amount) =>
            new Intl.NumberFormat("en-GB", {
              style: "currency",
              currency: "GBP",
              minimumFractionDigits: 2,
              maximumFractionDigits: 2,
            }).format(amount);

          // Helper function to create expense items
          const createExpenseItem = (template, data = {}) => {
            const clone = template.content.cloneNode(true);

            Object.entries(data).forEach(([key, value]) => {
              const input = clone.querySelector(`[name="${key}"]`);
              if (input) input.value = value;
            });

            return clone;
          };

          // Update totals and save data
          const updateAndSave = () => {
            updateTotals();
            saveToLocalStorage();
          };

          // Event listeners
          const { form, addMonthlyButton, addWeeklyButton, addDailyButton } =
            elements;

          // Single event listeners for form changes
          ["input", "change"].forEach((eventType) =>
            form.addEventListener(eventType, updateAndSave)
          );

          // Add expense functions using arrow functions and destructuring
          const addExpenseHandlers = {
            monthly: () => {
              const clone = createExpenseItem(elements.monthlyTemplate);
              elements.monthlyContainer.appendChild(clone);

              // Focus the name input of the newly added expense
              const nameInput =
                elements.monthlyContainer.lastElementChild.querySelector(
                  'input[name="monthly-name"]'
                );
              if (nameInput) nameInput.focus();

              updateAndSave();
            },
            weekly: () => {
              const clone = createExpenseItem(elements.weeklyTemplate);
              elements.weeklyContainer.appendChild(clone);

              // Focus the name input of the newly added expense
              const nameInput =
                elements.weeklyContainer.lastElementChild.querySelector(
                  'input[name="weekly-name"]'
                );
              if (nameInput) nameInput.focus();

              updateAndSave();
            },
            daily: () => {
              const clone = createExpenseItem(elements.dailyTemplate);
              elements.dailyContainer.appendChild(clone);

              // Focus the name input of the newly added expense
              const nameInput =
                elements.dailyContainer.lastElementChild.querySelector(
                  'input[name="daily-name"]'
                );
              if (nameInput) nameInput.focus();

              updateAndSave();
            },
          };

          // Attach event listeners
          addMonthlyButton.addEventListener(
            "click",
            addExpenseHandlers.monthly
          );
          addWeeklyButton.addEventListener("click", addExpenseHandlers.weekly);
          addDailyButton.addEventListener("click", addExpenseHandlers.daily);

          // Remove expense handling using event delegation
          form.addEventListener("click", ({ target }) => {
            if (target.classList.contains("remove-expense")) {
              target.closest(".expense-item").remove();
              updateAndSave();
            }
          });

          // Function to calculate and update totals
          const updateTotals = () => {
            const formData = new FormData(elements.form);

            // Calculate total monthly cost using reduce and modern syntax
            const monthlyTotal = [...formData.entries()]
              .filter(([name]) => name.endsWith("-amount"))
              .reduce((total, [name, value]) => {
                const numValue = parseFloat(value) || 0;

                // Use template literals and object lookup
                const multipliers = {
                  [`${EXPENSE_TYPES.MONTHLY}-amount`]: 1,
                  [`${EXPENSE_TYPES.WEEKLY}-amount`]:
                    DAYS_IN_MONTH / DAYS_IN_WEEK,
                  [`${EXPENSE_TYPES.DAILY}-amount`]: DAYS_IN_MONTH,
                };

                return total + numValue * (multipliers[name] || 0);
              }, 0);

            // Calculate expenses until payday
            const payDay = parseInt(formData.get("pay-day")) || 25;
            const paydayTotal = calculateExpensesUntilPayday(payDay);

            // Update the display using cached elements
            elements.monthlyTotal.textContent = formatCurrency(monthlyTotal);
            elements.paydayTotal.textContent = formatCurrency(paydayTotal);
          };

          const calculateExpensesUntilPayday = (payDay) => {
            const today = new Date();
            const { currentDay, currentMonth, currentYear } = {
              currentDay: today.getDate(),
              currentMonth: today.getMonth(),
              currentYear: today.getFullYear(),
            };

            // Determine payday date using ternary operator
            const payDayDate =
              payDay <= currentDay
                ? new Date(currentYear, currentMonth + 1, payDay)
                : new Date(currentYear, currentMonth, payDay);

            // Helper function to get expense amount
            const getExpenseAmount = (expense, selector) =>
              parseFloat(expense.querySelector(selector)?.value || 0);

            // Calculate daily expenses using modern array methods
            const dailyExpenses = [
              ...elements.dailyContainer.querySelectorAll(".expense-item"),
            ].reduce((total, expense) => {
              const amount = getExpenseAmount(
                expense,
                'input[name="daily-amount"]'
              );

              let daysUntilPayday = Math.ceil(
                (payDayDate - today) / MS_PER_DAY
              );

              // Handle edge case where today is payday
              if (
                currentDay === payDay &&
                payDayDate.getMonth() === currentMonth
              ) {
                daysUntilPayday = 1;
              }

              return total + amount * Math.max(0, daysUntilPayday);
            }, 0);

            // Calculate weekly expenses
            const weeklyExpenses = [
              ...elements.weeklyContainer.querySelectorAll(".expense-item"),
            ].reduce((total, expense) => {
              const amount = getExpenseAmount(
                expense,
                'input[name="weekly-amount"]'
              );
              const dayOfWeek = expense.querySelector(
                'select[name="weekly-day"]'
              )?.value;

              if (!dayOfWeek) return total;

              const targetDay = DAY_MAP[dayOfWeek];
              let nextOccurrence = new Date(today);

              // Find next occurrence of this day
              while (
                nextOccurrence.getDay() !== targetDay ||
                nextOccurrence <= today
              ) {
                nextOccurrence.setDate(nextOccurrence.getDate() + 1);
              }

              // Count occurrences before payday
              let occurrences = 0;
              while (nextOccurrence < payDayDate) {
                occurrences++;
                nextOccurrence.setDate(nextOccurrence.getDate() + DAYS_IN_WEEK);
              }

              return total + amount * occurrences;
            }, 0);

            // Calculate monthly expenses
            const monthlyExpenses = [
              ...elements.monthlyContainer.querySelectorAll(".expense-item"),
            ].reduce((total, expense) => {
              const amount = getExpenseAmount(
                expense,
                'input[name="monthly-amount"]'
              );
              const dayOfMonth = parseInt(
                expense.querySelector('input[name="monthly-day"]')?.value || 1
              );

              // Create expense date
              const expenseDate = new Date(
                currentYear,
                currentMonth,
                dayOfMonth
              );

              // Adjust to next month if day has passed
              if (dayOfMonth <= currentDay) {
                expenseDate.setMonth(expenseDate.getMonth() + 1);
              }

              // Include if occurs before payday
              return expenseDate < payDayDate ? total + amount : total;
            }, 0);

            return dailyExpenses + weeklyExpenses + monthlyExpenses;
          };

          // Function to extract expense data from DOM elements
          const extractExpenseData = (container, fields) =>
            [...container.querySelectorAll(".expense-item")]
              .map((expense) => {
                const data = fields.reduce((acc, field) => {
                  const element = expense.querySelector(`[name="${field}"]`);
                  acc[field.split("-").pop()] = element?.value || "";
                  return acc;
                }, {});

                // Only return if at least one field has data
                return Object.values(data).some(Boolean) ? data : null;
              })
              .filter(Boolean);

          // Function to save data to localStorage
          const saveToLocalStorage = () => {
            try {
              const data = {
                monthlyExpenses: extractExpenseData(elements.monthlyContainer, [
                  "monthly-name",
                  "monthly-amount",
                  "monthly-day",
                ]),
                weeklyExpenses: extractExpenseData(elements.weeklyContainer, [
                  "weekly-name",
                  "weekly-amount",
                  "weekly-day",
                ]),
                dailyExpenses: extractExpenseData(elements.dailyContainer, [
                  "daily-name",
                  "daily-amount",
                ]),
                payDay: new FormData(elements.form).get("pay-day"),
              };

              localStorage.setItem("budgetData", JSON.stringify(data));
            } catch (error) {
              console.error("Failed to save data to localStorage:", error);
            }
          };

          // Function to load data from localStorage
          const loadFromLocalStorage = () => {
            try {
              const savedData = localStorage.getItem("budgetData");
              if (!savedData) return;

              const data = JSON.parse(savedData);

              // Load payday using optional chaining
              if (data.payDay) {
                elements.payDayInput.value = data.payDay;
              }

              // Helper function to load expenses
              const loadExpenses = (expenses, template, container, type) => {
                expenses?.forEach((expense) => {
                  const clone = createExpenseItem(template, {
                    [`${type}-name`]: expense.name,
                    [`${type}-amount`]: expense.amount,
                    [`${type}-day`]: expense.day,
                  });
                  container.appendChild(clone);
                });
              };

              // Load all expense types using destructuring
              const { monthlyExpenses, weeklyExpenses, dailyExpenses } = data;

              loadExpenses(
                monthlyExpenses,
                elements.monthlyTemplate,
                elements.monthlyContainer,
                EXPENSE_TYPES.MONTHLY
              );
              loadExpenses(
                weeklyExpenses,
                elements.weeklyTemplate,
                elements.weeklyContainer,
                EXPENSE_TYPES.WEEKLY
              );
              loadExpenses(
                dailyExpenses,
                elements.dailyTemplate,
                elements.dailyContainer,
                EXPENSE_TYPES.DAILY
              );

              // Update totals after loading
              updateTotals();
            } catch (error) {
              console.error("Failed to load data from localStorage:", error);
            }
          };

          // Load saved data when page loads
          loadFromLocalStorage();
        </script>
      </form>

      <footer>
        <div class="copyright">Â© Remi Shergold</div>
        <div class="tagline">My first vibe coded app</div>
      </footer>
    </div>
  </body>
</html>
