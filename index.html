<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Budget App</title>
    <style>
      :root {
        /* iOS Colors */
        --ios-blue: #007aff;
        --ios-blue-light: #5ac8fa;
        --ios-blue-dark: #0051d0;
        --ios-red: #ff3b30;
        --ios-red-light: #ff6961;
        --ios-red-dark: #d70015;
        --ios-green: #34c759;
        --ios-orange: #ff9500;
        --ios-purple: #af52de;
        --ios-gray: #8e8e93;
        --ios-gray-light: #c7c7cc;
        --ios-gray-ultralight: #f2f2f7;
        --ios-separator: rgba(60, 60, 67, 0.36);

        /* iOS Backgrounds */
        --ios-background: #f2f2f7;
        --ios-grouped-background: #ffffff;
        --ios-secondary-background: #ffffff;
        --ios-tertiary-background: #f2f2f7;

        /* iOS Text Colors */
        --ios-label: #000000;
        --ios-secondary-label: rgba(60, 60, 67, 0.6);
        --ios-tertiary-label: rgba(60, 60, 67, 0.3);
        --ios-quaternary-label: rgba(60, 60, 67, 0.18);

        /* Spacing */
        --spacing-xs: 0.25rem;
        --spacing-sm: 0.5rem;
        --spacing-md: 0.75rem;
        --spacing-lg: 1rem;
        --spacing-xl: 1.25rem;
        --spacing-2xl: 2rem;
        --spacing-3xl: 3rem;

        /* iOS Border radius */
        --ios-radius: 0.625rem;
        --ios-radius-large: 1rem;
        --ios-radius-xl: 1.25rem;

        /* iOS Typography */
        --ios-title1: 1.75rem;
        --ios-title2: 1.375rem;
        --ios-title3: 1.25rem;
        --ios-headline: 1.063rem;
        --ios-body: 1rem;
        --ios-callout: 1rem;
        --ios-subhead: 0.938rem;
        --ios-footnote: 0.813rem;
        --ios-caption1: 0.75rem;
        --ios-caption2: 0.688rem;

        /* iOS Shadows */
        --ios-shadow-light: 0 1px 3px rgba(0, 0, 0, 0.12);
        --ios-shadow-medium: 0 4px 6px rgba(0, 0, 0, 0.07);
        --ios-shadow-large: 0 10px 25px rgba(0, 0, 0, 0.15);
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display",
          "SF Pro Text", sans-serif;
        background: var(--ios-background);
        color: var(--ios-label);
        line-height: 1.4;
        padding: 0;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      /* iOS-style app container */
      .app-container {
        max-width: 26rem;
        margin: 0 auto;
        background: var(--ios-background);
        min-height: 100vh;
        padding: 0 var(--spacing-lg) var(--spacing-lg) var(--spacing-lg);
      }

      /* iOS-style sections */
      fieldset {
        border: none;
        border-radius: var(--ios-radius);
        margin-bottom: var(--spacing-2xl);
        padding: 0;
        background: var(--ios-grouped-background);
        box-shadow: var(--ios-shadow-light);
        overflow: hidden;
      }

      /* iOS-style section headers */
      legend {
        width: 100%;
        padding: var(--spacing-lg) var(--spacing-xl);
        background: var(--ios-grouped-background);
        color: var(--ios-label);
        font-size: var(--ios-title3);
        font-weight: 600;
        border: none;
        border-radius: 0;
        text-shadow: none;
        box-shadow: none;
        border-bottom: 1px solid var(--ios-separator);
        margin-bottom: 0;
      }

      /* iOS-style list items */
      .expense-item {
        border-bottom: 1px solid var(--ios-separator);
        padding: var(--spacing-lg) var(--spacing-xl);
        background: var(--ios-grouped-background);
        position: relative;
      }

      .expense-item:last-child {
        border-bottom: none;
      }

      /* iOS-style input rows */
      .name-row {
        margin-bottom: var(--spacing-lg);
        display: flex;
        align-items: center;
        gap: var(--spacing-lg);
      }

      .name-row input {
        flex: 1;
      }

      .name-row .remove-expense {
        flex: 0 0 auto;
      }

      .details-row {
        display: flex;
        gap: var(--spacing-lg);
        align-items: center;
      }

      .details-row input,
      .details-row select {
        flex: 1;
        min-width: 0;
      }

      .details-row .amount-input-wrapper {
        flex: 1;
        min-width: 0;
      }

      .details-row .day-input-wrapper {
        flex: 1;
        min-width: 0;
      }

      /* iOS-style trash icon remove button */
      .expense-item .remove-expense {
        width: 2.75rem;
        height: 2.75rem;
        border-radius: var(--ios-radius);
        background: transparent;
        color: var(--ios-red);
        border: none;
        font-size: 0;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0;
        margin: 0;
        transition: all 0.2s ease;
        opacity: 0.8;
        flex-shrink: 0;
        background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23ff3b30' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='3,6 5,6 21,6'%3e%3c/polyline%3e%3cpath d='m19,6v14a2,2 0 0 1 -2,2H7a2,2 0 0 1 -2,-2V6m3,0V4a2,2 0 0 1 2,-2h4a2,2 0 0 1 2,2v2'%3e%3c/path%3e%3cline x1='10' y1='11' x2='10' y2='17'%3e%3c/line%3e%3cline x1='14' y1='11' x2='14' y2='17'%3e%3c/line%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: center;
        background-size: 1.25rem;
      }

      .expense-item .remove-expense:hover {
        opacity: 1;
      }

      .expense-item .remove-expense:active {
        transform: scale(0.95);
        opacity: 0.6;
      }

      /* iOS-style labels */
      label {
        display: block;
        margin-bottom: var(--spacing-sm);
        font-weight: 400;
        color: var(--ios-secondary-label);
        font-size: var(--ios-footnote);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      /* iOS-style inputs */
      input,
      select {
        width: 100%;
        padding: var(--spacing-lg);
        border: none;
        border-radius: var(--ios-radius);
        font-size: var(--ios-body);
        background: var(--ios-tertiary-background);
        color: var(--ios-label);
        -webkit-appearance: none;
        appearance: none;
        font-family: inherit;
        transition: all 0.2s ease;
      }

      /* iOS-style select dropdown */
      select {
        background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23007aff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right var(--spacing-lg) center;
        background-size: 1rem;
        padding-right: 3rem;
      }

      input[name="pay-day"] {
        width: 5rem;
        text-align: center;
      }

      /* iOS-style input prefixes */
      .amount-input-wrapper {
        position: relative;
      }

      .amount-input-wrapper::before {
        content: "Â£";
        position: absolute;
        left: var(--spacing-lg);
        top: 50%;
        transform: translateY(-50%);
        color: var(--ios-secondary-label);
        font-size: var(--ios-body);
        font-weight: 500;
        pointer-events: none;
        z-index: 1;
      }

      .day-input-wrapper {
        position: relative;
      }

      .day-input-wrapper::before {
        content: "Day:";
        position: absolute;
        left: var(--spacing-lg);
        top: 50%;
        transform: translateY(-50%);
        color: var(--ios-secondary-label);
        font-size: var(--ios-body);
        font-weight: 500;
        pointer-events: none;
        z-index: 1;
      }

      input[name$="-amount"] {
        padding-left: 2.5rem;
      }

      input[name="monthly-day"] {
        padding-left: 3.5rem;
      }

      /* iOS-style focus states */
      input:focus,
      select:focus {
        outline: none;
        background-color: white;
        box-shadow: 0 0 0 2px var(--ios-blue);
        transform: scale(1.02);
      }

      /* iOS-style buttons */
      button:not(.remove-expense) {
        width: 100%;
        padding: var(--spacing-xl);
        background: transparent;
        color: var(--ios-blue);
        border: none;
        border-radius: var(--ios-radius);
        font-size: var(--ios-body);
        font-weight: 400;
        cursor: pointer;
        margin: 0;
        transition: all 0.2s ease;
        font-family: inherit;
      }

      button:not(.remove-expense):hover {
        color: var(--ios-blue-dark);
      }

      button:not(.remove-expense):active {
        opacity: 0.6;
        transform: scale(0.95);
      }

      /* Container spacing */
      #monthly-expenses-container,
      #weekly-expenses-container,
      #daily-expenses-container {
        margin-bottom: 0;
      }

      /* Pay day section content */
      .pay-day-content {
        padding: var(--spacing-xl);
      }

      /* Pay day explanation text */
      .pay-day-explanation {
        margin-bottom: var(--spacing-lg);
        color: var(--ios-label);
        font-size: var(--ios-body);
        line-height: 1.5;
      }

      /* iOS-style app header */
      .app-header {
        position: relative;
        left: 50%;
        right: 50%;
        margin-left: -50vw;
        margin-right: -50vw;
        width: 100vw;
        background: linear-gradient(135deg, #64b5f6 0%, #a4c0d6 100%);
        color: var(--ios-label);
        box-shadow: 0 2px 8px rgba(0, 122, 255, 0.1);
        margin-bottom: var(--spacing-2xl);
      }

      .app-header-content {
        max-width: 26rem;
        margin: 0 auto;
        padding: var(--spacing-2xl) var(--spacing-lg) var(--spacing-2xl)
          var(--spacing-lg);
        text-align: left;
      }

      .app-header h1 {
        font-size: var(--ios-title2);
        font-weight: 600;
        margin-bottom: var(--spacing-2xl);
        text-align: left;
        color: var(--ios-label);
      }

      .app-header .primary-stat {
        margin-bottom: var(--spacing-2xl);
      }

      .app-header .primary-stat-label {
        font-size: var(--ios-body);
        color: var(--ios-label);
        margin-bottom: var(--spacing-sm);
        font-weight: 400;
      }

      .app-header .primary-stat-value {
        font-size: 3rem;
        font-weight: 700;
        color: var(--ios-label);
        line-height: 1;
      }

      .app-header .secondary-stat {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--spacing-md) var(--spacing-xl);
        background: rgba(255, 255, 255, 0.6);
        border-radius: var(--ios-radius);
        backdrop-filter: blur(10px);
      }

      .app-header .secondary-stat-label {
        font-size: var(--ios-callout);
        color: var(--ios-secondary-label);
        font-weight: 400;
      }

      .app-header .secondary-stat-value {
        font-size: var(--ios-callout);
        font-weight: 600;
        color: var(--ios-label);
      }

      .app-header hr {
        border: none;
        height: 1px;
        background: rgba(255, 255, 255, 0.2);
        margin: var(--spacing-lg) 0;
      }

      hr {
        border: none;
        height: 1px;
        background: rgba(255, 255, 255, 0.2);
        margin: var(--spacing-lg) var(--spacing-xl);
      }

      /* iOS-style responsive improvements */
      @media (max-width: 30rem) {
        fieldset {
          border-radius: var(--ios-radius);
          margin-bottom: var(--spacing-xl);
        }

        legend {
          font-size: var(--ios-title3);
          padding: var(--spacing-lg);
        }

        .expense-item {
          padding: var(--spacing-lg);
        }

        input,
        select,
        button {
          font-size: var(--ios-body);
        }
      }

      /* iOS-style loading animation */
      .expense-item {
        animation: slideInFromRight 0.3s ease-out;
      }

      @keyframes slideInFromRight {
        from {
          opacity: 0;
          transform: translateX(20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      /* iOS-style touch improvements */
      button,
      input,
      select {
        min-height: 2.75rem;
        -webkit-tap-highlight-color: transparent;
      }

      /* Webpage-style footer */
      footer {
        margin-top: var(--spacing-3xl);
        padding: var(--spacing-2xl) var(--spacing-xl);
        background: transparent;
        border-top: 1px solid var(--ios-separator);
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: var(--ios-footnote);
        color: var(--ios-secondary-label);
        position: relative;
        left: 50%;
        right: 50%;
        margin-left: -50vw;
        margin-right: -50vw;
        width: 100vw;
      }

      footer .copyright {
        font-weight: 600;
        color: var(--ios-label);
      }

      footer .tagline {
        font-style: italic;
        color: var(--ios-tertiary-label);
      }

      .footer-content {
        max-width: 26rem;
        margin: 0 auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
      }

      @media (max-width: 30rem) {
        footer {
          padding: var(--spacing-xl);
        }

        .footer-content {
          flex-direction: column;
          gap: var(--spacing-sm);
          text-align: center;
        }
      }
    </style>
  </head>
  <body>
    <div class="app-container">
      <form id="budget-form">
        <div class="app-header">
          <div class="app-header-content">
            <h1>Expenses</h1>

            <div class="primary-stat">
              <div class="primary-stat-label">Outstanding</div>
              <div class="primary-stat-value" id="payday-total">Â£0.00</div>
            </div>

            <div class="secondary-stat">
              <span class="secondary-stat-label">Month total</span>
              <span class="secondary-stat-value" id="monthly-total">Â£0.00</span>
            </div>
          </div>
        </div>

        <template id="monthly-expense-template">
          <div class="expense-item monthly-expense">
            <div class="name-row">
              <input
                type="text"
                name="monthly-name"
                placeholder="Name"
                tabindex="1"
              />
              <button
                type="button"
                class="remove-expense"
                aria-label="Remove expense"
                tabindex="4"
              ></button>
            </div>
            <div class="details-row">
              <div class="amount-input-wrapper">
                <input
                  type="number"
                  name="monthly-amount"
                  step="0.01"
                  inputmode="decimal"
                  placeholder="Amount"
                  tabindex="2"
                />
              </div>
              <div class="day-input-wrapper">
                <input
                  type="number"
                  name="monthly-day"
                  min="1"
                  max="31"
                  inputmode="numeric"
                  placeholder="Day of the month"
                  tabindex="3"
                />
              </div>
            </div>
          </div>
        </template>

        <template id="weekly-expense-template">
          <div class="expense-item weekly-expense">
            <div class="name-row">
              <input
                type="text"
                name="weekly-name"
                placeholder="Name"
                tabindex="1"
              />
              <button
                type="button"
                class="remove-expense"
                aria-label="Remove expense"
                tabindex="4"
              ></button>
            </div>
            <div class="details-row">
              <div class="amount-input-wrapper">
                <input
                  type="number"
                  name="weekly-amount"
                  step="0.01"
                  inputmode="decimal"
                  placeholder="Amount"
                  tabindex="2"
                />
              </div>
              <select name="weekly-day" tabindex="3">
                <option value="">Day of Week</option>
                <option value="0">Sunday</option>
                <option value="1">Monday</option>
                <option value="2">Tuesday</option>
                <option value="3">Wednesday</option>
                <option value="4">Thursday</option>
                <option value="5">Friday</option>
                <option value="6">Saturday</option>
              </select>
            </div>
          </div>
        </template>

        <template id="daily-expense-template">
          <div class="expense-item daily-expense">
            <div class="name-row">
              <input
                type="text"
                name="daily-name"
                placeholder="Name"
                tabindex="1"
              />
              <button
                type="button"
                class="remove-expense"
                aria-label="Remove expense"
                tabindex="3"
              ></button>
            </div>
            <div class="details-row">
              <div class="amount-input-wrapper">
                <input
                  type="number"
                  name="daily-amount"
                  step="0.01"
                  inputmode="decimal"
                  placeholder="Amount"
                  tabindex="2"
                />
              </div>
            </div>
          </div>
        </template>

        <fieldset>
          <legend>Pay Day</legend>
          <div class="pay-day-content">
            <p class="pay-day-explanation">
              Enter the day of the month you receive your salary to calculate
              how much you'll spend before your next payday. This helps you plan
              your cash flow and avoid overdrafts.
            </p>
            <label
              >Pay day:
              <input
                type="number"
                name="pay-day"
                step="1"
                min="1"
                max="31"
                value="25"
              />
            </label>
          </div>
        </fieldset>

        <fieldset>
          <legend>Monthly Expenses</legend>
          <div id="monthly-expenses-container"></div>
          <button type="button" id="add-monthly-expense">
            Add Monthly Expense
          </button>
        </fieldset>

        <fieldset>
          <legend>Weekly Expenses</legend>
          <div id="weekly-expenses-container"></div>
          <button type="button" id="add-weekly-expense">
            Add Weekly Expense
          </button>
        </fieldset>

        <fieldset>
          <legend>Daily Expenses</legend>
          <div id="daily-expenses-container"></div>
          <button type="button" id="add-daily-expense">
            Add Daily Expense
          </button>
        </fieldset>

        <script>
          // Constants
          const DAYS_IN_MONTH = 31;
          const DAYS_IN_WEEK = 7;
          const MS_PER_DAY = 1000 * 60 * 60 * 24;

          // Cache DOM elements
          const elements = {
            form: document.getElementById("budget-form"),
            monthlyTemplate: document.getElementById(
              "monthly-expense-template"
            ),
            monthlyContainer: document.getElementById(
              "monthly-expenses-container"
            ),
            addMonthlyButton: document.getElementById("add-monthly-expense"),
            weeklyTemplate: document.getElementById("weekly-expense-template"),
            weeklyContainer: document.getElementById(
              "weekly-expenses-container"
            ),
            addWeeklyButton: document.getElementById("add-weekly-expense"),
            dailyTemplate: document.getElementById("daily-expense-template"),
            dailyContainer: document.getElementById("daily-expenses-container"),
            addDailyButton: document.getElementById("add-daily-expense"),
            monthlyTotal: document.getElementById("monthly-total"),
            paydayTotal: document.getElementById("payday-total"),
            payDayInput: document.querySelector('input[name="pay-day"]'),
          };

          // Currency formatter
          const formatCurrency = (amount) =>
            new Intl.NumberFormat("en-GB", {
              style: "currency",
              currency: "GBP",
              minimumFractionDigits: 2,
              maximumFractionDigits: 2,
            }).format(amount);

          // Helper function to create expense items
          const createExpenseItem = (template, data = {}) => {
            const clone = template.content.cloneNode(true);

            Object.entries(data).forEach(([key, value]) => {
              const input = clone.querySelector(`[name="${key}"]`);
              if (input) input.value = value;
            });

            return clone;
          };

          // Update totals and save data
          const updateAndSave = () => {
            updateTotals();
            saveToLocalStorage();
          };

          // Event listeners
          const { form, addMonthlyButton, addWeeklyButton, addDailyButton } =
            elements;

          // Single event listeners for form changes
          ["input", "change"].forEach((eventType) =>
            form.addEventListener(eventType, updateAndSave)
          );

          // Add expense functions
          const addExpense = (template, container, nameSelector) => () => {
            const clone = createExpenseItem(template);
            container.appendChild(clone);
            container.lastElementChild.querySelector(nameSelector)?.focus();
            updateAndSave();
          };

          // Attach event listeners
          addMonthlyButton.addEventListener(
            "click",
            addExpense(
              elements.monthlyTemplate,
              elements.monthlyContainer,
              'input[name="monthly-name"]'
            )
          );
          addWeeklyButton.addEventListener(
            "click",
            addExpense(
              elements.weeklyTemplate,
              elements.weeklyContainer,
              'input[name="weekly-name"]'
            )
          );
          addDailyButton.addEventListener(
            "click",
            addExpense(
              elements.dailyTemplate,
              elements.dailyContainer,
              'input[name="daily-name"]'
            )
          );

          // Remove expense handling using event delegation
          form.addEventListener("click", ({ target }) => {
            if (target.classList.contains("remove-expense")) {
              target.closest(".expense-item").remove();
              updateAndSave();
            }
          });

          // Function to calculate and update totals
          const updateTotals = () => {
            const formData = new FormData(elements.form);

            // Calculate total monthly cost using reduce and modern syntax
            const multipliers = {
              "monthly-amount": 1,
              "weekly-amount": DAYS_IN_MONTH / DAYS_IN_WEEK,
              "daily-amount": DAYS_IN_MONTH,
            };

            const monthlyTotal = [...formData.entries()]
              .filter(([name]) => name.endsWith("-amount"))
              .reduce(
                (total, [name, value]) =>
                  total + (parseFloat(value) || 0) * (multipliers[name] || 0),
                0
              );

            // Calculate expenses until payday
            const payDay = parseInt(formData.get("pay-day")) || 25;
            const paydayTotal = calculateExpensesUntilPayday(payDay);

            // Update the display using cached elements
            elements.monthlyTotal.textContent = formatCurrency(monthlyTotal);
            elements.paydayTotal.textContent = formatCurrency(paydayTotal);
          };

          const calculateExpensesUntilPayday = (payDay) => {
            const today = new Date();
            const currentDay = today.getDate();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();

            // Determine payday date using ternary operator
            const payDayDate =
              payDay <= currentDay
                ? new Date(currentYear, currentMonth + 1, payDay)
                : new Date(currentYear, currentMonth, payDay);

            // Helper function to get expense amount
            const getExpenseAmount = (expense, selector) =>
              parseFloat(expense.querySelector(selector)?.value || 0);

            // Calculate daily expenses using modern array methods
            const dailyExpenses = [
              ...elements.dailyContainer.querySelectorAll(".expense-item"),
            ].reduce((total, expense) => {
              const amount = getExpenseAmount(
                expense,
                'input[name="daily-amount"]'
              );
              let daysUntilPayday = Math.ceil(
                (payDayDate - today) / MS_PER_DAY
              );

              // Handle edge case where today is payday
              if (
                currentDay === payDay &&
                payDayDate.getMonth() === currentMonth
              ) {
                daysUntilPayday = 1;
              }

              return total + amount * Math.max(0, daysUntilPayday);
            }, 0);

            // Calculate weekly expenses
            const weeklyExpenses = [
              ...elements.weeklyContainer.querySelectorAll(".expense-item"),
            ].reduce((total, expense) => {
              const amount = getExpenseAmount(
                expense,
                'input[name="weekly-amount"]'
              );
              const dayOfWeek = expense.querySelector(
                'select[name="weekly-day"]'
              )?.value;

              if (!dayOfWeek) return total;

              const targetDay = parseInt(dayOfWeek);
              let nextOccurrence = new Date(today);

              // Find next occurrence of this day
              while (
                nextOccurrence.getDay() !== targetDay ||
                nextOccurrence <= today
              ) {
                nextOccurrence.setDate(nextOccurrence.getDate() + 1);
              }

              // Count occurrences before payday
              let occurrences = 0;
              while (nextOccurrence < payDayDate) {
                occurrences++;
                nextOccurrence.setDate(nextOccurrence.getDate() + DAYS_IN_WEEK);
              }

              return total + amount * occurrences;
            }, 0);

            // Calculate monthly expenses
            const monthlyExpenses = [
              ...elements.monthlyContainer.querySelectorAll(".expense-item"),
            ].reduce((total, expense) => {
              const amount = getExpenseAmount(
                expense,
                'input[name="monthly-amount"]'
              );
              const dayOfMonth = parseInt(
                expense.querySelector('input[name="monthly-day"]')?.value || 1
              );

              // Create expense date
              const expenseDate = new Date(
                currentYear,
                currentMonth,
                dayOfMonth
              );

              // Adjust to next month if day has passed
              if (dayOfMonth <= currentDay) {
                expenseDate.setMonth(expenseDate.getMonth() + 1);
              }

              // Include if occurs before payday
              return expenseDate < payDayDate ? total + amount : total;
            }, 0);

            return dailyExpenses + weeklyExpenses + monthlyExpenses;
          };

          // Function to extract expense data from DOM elements
          const extractExpenseData = (container, fields) =>
            [...container.querySelectorAll(".expense-item")]
              .map((expense) => {
                const data = Object.fromEntries(
                  fields.map((field) => [
                    field.split("-").pop(),
                    expense.querySelector(`[name="${field}"]`)?.value || "",
                  ])
                );
                return Object.values(data).some(Boolean) ? data : null;
              })
              .filter(Boolean);

          // Function to save data to localStorage
          const saveToLocalStorage = () => {
            try {
              const data = {
                monthlyExpenses: extractExpenseData(elements.monthlyContainer, [
                  "monthly-name",
                  "monthly-amount",
                  "monthly-day",
                ]),
                weeklyExpenses: extractExpenseData(elements.weeklyContainer, [
                  "weekly-name",
                  "weekly-amount",
                  "weekly-day",
                ]),
                dailyExpenses: extractExpenseData(elements.dailyContainer, [
                  "daily-name",
                  "daily-amount",
                ]),
                payDay: new FormData(elements.form).get("pay-day"),
              };

              localStorage.setItem("budgetData", JSON.stringify(data));
            } catch (error) {
              console.error("Failed to save data to localStorage:", error);
            }
          };

          // Function to load data from localStorage
          const loadFromLocalStorage = () => {
            try {
              const savedData = localStorage.getItem("budgetData");
              if (!savedData) return;

              const data = JSON.parse(savedData);

              // Load payday using optional chaining
              if (data.payDay) {
                elements.payDayInput.value = data.payDay;
              }

              // Helper function to load expenses
              const loadExpenses = (expenses, template, container, type) => {
                expenses?.forEach((expense) => {
                  const clone = createExpenseItem(template, {
                    [`${type}-name`]: expense.name,
                    [`${type}-amount`]: expense.amount,
                    [`${type}-day`]: expense.day,
                  });
                  container.appendChild(clone);
                });
              };

              // Load all expense types
              const { monthlyExpenses, weeklyExpenses, dailyExpenses } = data;

              loadExpenses(
                monthlyExpenses,
                elements.monthlyTemplate,
                elements.monthlyContainer,
                "monthly"
              );
              loadExpenses(
                weeklyExpenses,
                elements.weeklyTemplate,
                elements.weeklyContainer,
                "weekly"
              );
              loadExpenses(
                dailyExpenses,
                elements.dailyTemplate,
                elements.dailyContainer,
                "daily"
              );

              // Update totals after loading
              updateTotals();
            } catch (error) {
              console.error("Failed to load data from localStorage:", error);
            }
          };

          // Load saved data when page loads
          loadFromLocalStorage();
        </script>
      </form>

      <footer>
        <div class="footer-content">
          <div class="copyright">Â© Remi Shergold</div>
          <div class="tagline">My first vibe coded app</div>
        </div>
      </footer>
    </div>
  </body>
</html>
